================================================================================
naretore-design データ仕様書
================================================================================
作成日: 2025-11-25
対象: naretore-design（トレーニングコンテンツ作成アプリケーション）

================================================================================
1. ビューとタブの定義
================================================================================

1.1 メインビュー（currentView）
--------------------------------------------------------------------------------
型: string
定義場所: public/js/state.js
初期値: 'contentCreation'

利用可能な値:
┌──────────────────────┬──────────────────────────────────┐
│ 値                   │ 説明                             │
├──────────────────────┼──────────────────────────────────┤
│ 'summary'            │ サマリービュー（統計情報）       │
│ 'playerList'         │ プレイヤー一覧                   │
│ 'ranking'            │ ランキング                       │
│ 'log'                │ ログ一覧                         │
│ 'contentCreation'    │ コンテンツ作成（デフォルト）     │
│ 'dataLoader'         │ データローダー                   │
└──────────────────────┴──────────────────────────────────┘

1.2 操作タブ（コンテンツ作成ビュー内）
--------------------------------------------------------------------------------
型: string
定義場所: HTMLおよびswitchOperationTab関数

利用可能な値:
┌──────────────────────┬──────────────────────────────────┐
│ 値                   │ 説明                             │
├──────────────────────┼──────────────────────────────────┤
│ 'chat'               │ チャットタブ                     │
│ 'files'              │ ファイルタブ                     │
│ 'script'             │ 会話の流れタブ                   │
│ 'config'             │ 設計書タブ                       │
└──────────────────────┴──────────────────────────────────┘


================================================================================
2. トレーニングモード
================================================================================

2.1 トレーニングモード一覧
--------------------------------------------------------------------------------
定義場所: public/js/data-loader.js, public/js/agents.js

モード定義:
┌──────────────────┬──────────────┬──────────────────────────────────────────┐
│ モード名（日本語）│ 内部キー     │ 説明                                     │
├──────────────────┼──────────────┼──────────────────────────────────────────┤
│ 台本モード       │ subtitle     │ AIが一人で両役を実演                     │
│ お手本モード     │ aiDemo       │ AIが顧客役+ユーザーへのサポート          │
│ 確認モード       │ confirmation │ AIが顧客役、ユーザーの自由会話           │
│ 実戦モード       │ practice     │ AIが本物の顧客として難しい対応           │
└──────────────────┴──────────────┴──────────────────────────────────────────┘

2.2 モードとエージェント/プロンプトの対応
--------------------------------------------------------------------------------

【台本生成エージェント（ScriptGenerationAgents）】
┌──────────────────┬──────────────────────────────────────────────────────────┐
│ 内部キー         │ プロンプトファイル                                       │
├──────────────────┼──────────────────────────────────────────────────────────┤
│ subtitle         │ prompts/script-generation-subtitle.md                    │
│ points           │ prompts/script-generation-points.md                      │
│ practice         │ prompts/script-generation-practice.md                    │
└──────────────────┴──────────────────────────────────────────────────────────┘

【システムプロンプト生成エージェント（SystemPromptAgents）】
┌──────────────────┬──────────────────────────────────────────────────────────┐
│ 内部キー         │ プロンプトファイル                                       │
├──────────────────┼──────────────────────────────────────────────────────────┤
│ subtitle         │ prompts/system-prompt-subtitle-mode.md                   │
│ aiDemo           │ prompts/system-prompt-aiDemo-mode.md                     │
│ confirmation     │ prompts/system-prompt-confirmation-mode.md               │
│ practice         │ prompts/system-prompt-practice-mode.md                   │
└──────────────────┴──────────────────────────────────────────────────────────┘

【モードと使用台本の対応】
┌──────────────────┬──────────────────────────────────────────────────────────┐
│ システムプロンプト│ 使用する台本                                             │
├──────────────────┼──────────────────────────────────────────────────────────┤
│ subtitle         │ subtitle script                                          │
│ aiDemo           │ points script                                            │
│ confirmation     │ points script                                            │
│ practice         │ practice script                                          │
└──────────────────┴──────────────────────────────────────────────────────────┘


================================================================================
3. ファイルアップロード関連データ
================================================================================

3.1 uploadedFiles（アップロードファイル配列）
--------------------------------------------------------------------------------
型: Array<UploadedFile>
定義場所: public/js/content-creation.js
初期値: []

UploadedFile型:
{
  name: string,           // ファイル名
  size: number,           // ファイルサイズ（バイト）
  type: string,           // MIMEタイプ
  file: File,             // Fileオブジェクト
  dataType: DataType,     // データタイプ（後述）
  extractedText: string   // 抽出されたテキスト
}

3.2 DataType（データタイプ）
--------------------------------------------------------------------------------
型: string | null
定義場所: public/js/content-creation.js

利用可能な値:
┌──────────────────┬──────────────────────────────────────────────────────────┐
│ 値               │ 説明                                                     │
├──────────────────┼──────────────────────────────────────────────────────────┤
│ 'sample'         │ 見本データ（商談や接客の正解例）                         │
│ 'material'       │ 教材データ（学ばせたい内容の資料）                       │
│ 'company'        │ 自社データ（商品情報や会社概要）                         │
│ 'customer'       │ 顧客データ（想定顧客やペルソナ）                         │
│ 'other'          │ その他                                                   │
│ null             │ 未選択                                                   │
└──────────────────┴──────────────────────────────────────────────────────────┘

3.3 FILE_TAGS（ファイルタグ定数）
--------------------------------------------------------------------------------
定義場所: public/js/content-creation.js

{
  DIALOGUE: '対話データ',
  MATERIAL: '教材データ',
  PRODUCT: '商品データ',
  PERSONA: 'ペルソナデータ',
  UNSPECIFIED: '指定なし'
}

3.4 対応ファイル形式
--------------------------------------------------------------------------------
対応拡張子: .txt, .pdf, .ppt, .pptx, .xlsx, .xls, .mp3, .wav, .mp4, .mov


================================================================================
4. ロープレ設計データ
================================================================================

4.1 RoleplayDesignData
--------------------------------------------------------------------------------
型: Object
定義場所: window.getRoleplayDesignData() / window.setRoleplayDesignData()

構造:
{
  situation: string,        // シチュエーション設定
  opponentSetting: string,  // 相手の設定
  missions: {
    required: string[],     // 必須ミッション（配列）
    scoring: string[],      // 採点ミッション（配列）
    failure: string[]       // 失敗条件（配列）
  },
  points: Point[]           // ポイント（配列）
}

Point型:
{
  question: string,         // 質問/発言
  criteria: string,         // 正解基準
  example: string           // 正答例
}


================================================================================
5. 生成結果データ
================================================================================

5.1 Scripts（台本データ）
--------------------------------------------------------------------------------
型: Object
生成元: ScriptGenerationAgents.generateScripts()

構造:
{
  subtitle: string,   // 台本モード用台本
  points: string,     // ポイントモード用台本
  practice: string    // 実戦モード用台本
}

台本フォーマット:
```
## シーン設定
[設定内容]

## 登場人物
- プレイヤー: [名前・役割]
- 相手: [名前・特徴]

## 会話
プレイヤー: [発言内容]
相手: [発言内容]
ナレーター: [説明]
...
```

5.2 SystemPrompts（システムプロンプトデータ）
--------------------------------------------------------------------------------
型: Object
生成元: SystemPromptAgents.generateSystemPrompts()

構造:
{
  subtitle: string,       // 台本モード用プロンプト
  aiDemo: string,         // お手本モード用プロンプト
  confirmation: string,   // 確認モード用プロンプト
  practice: string        // 実戦モード用プロンプト
}

5.3 editedPrompts（編集済みプロンプト）
--------------------------------------------------------------------------------
型: Object
定義場所: window.editedPrompts
用途: ユーザーが編集したプロンプトを保存

構造:
{
  subtitle?: string,
  aiDemo?: string,
  confirmation?: string,
  practice?: string
}

5.4 editedScript（編集済み台本）
--------------------------------------------------------------------------------
型: string
定義場所: window.editedScript
用途: ユーザーが編集した台本を保存


================================================================================
6. セッションデータ（ダミーデータ）
================================================================================

6.1 allSessions（プレイセッション配列）
--------------------------------------------------------------------------------
型: Array<Session>
定義場所: public/js/data.js
データソース: demo-data.csv（ダミーデータ）
データ種別: 【ダミーデータ】実際の本番データはCSVアップロードで差し替え

Session型:
{
  date: Date,           // プレイ日時
  org: string,          // 組織名
  account: string,      // アカウント名
  group: string,        // グループ名
  player: string,       // プレイヤー名
  category: string,     // カテゴリ（レッスン種別）
  level: number,        // レベル（1, 2, ...）
  lesson: string,       // レッスン名
  score: number,        // スコア（0-100）
  speechTime: number,   // 発話時間（秒）
  playTime: number      // プレイ時間（秒）
}

6.2 CSVフォーマット
--------------------------------------------------------------------------------
ファイル: public/demo-data.csv
データ種別: 【ダミーデータ】

ヘッダー:
日付,Org,Account,Group,Player,カテゴリ,レベル,レッスン,スコア,発話時間,プレイ時間

サンプル行:
2025-09-28T13:57:44.000Z,リコージャパン,リコーエンタープライズ,New Group,近藤　朋佳,【9月】業種別ヒアリング,1,建設業 現業部門（レクチャー）,97,31,46.1

フィールド定義:
┌─────────────┬─────────────────────────────────────────────────────────────┐
│ カラム      │ 型・説明                                                    │
├─────────────┼─────────────────────────────────────────────────────────────┤
│ 日付        │ ISO 8601形式（例: 2025-09-28T13:57:44.000Z）               │
│ Org         │ string - 組織名                                             │
│ Account     │ string - アカウント名                                       │
│ Group       │ string - グループ名                                         │
│ Player      │ string - プレイヤー名                                       │
│ カテゴリ    │ string - レッスンカテゴリ                                   │
│ レベル      │ number - レベル番号（1, 2, ...）                            │
│ レッスン    │ string - レッスン名                                         │
│ スコア      │ number - スコア（0-100）                                    │
│ 発話時間    │ number - 発話時間（秒）                                     │
│ プレイ時間  │ number - プレイ時間（秒）                                   │
└─────────────┴─────────────────────────────────────────────────────────────┘


================================================================================
7. 状態管理データ
================================================================================

7.1 filterState（フィルター状態）
--------------------------------------------------------------------------------
型: Object
定義場所: public/js/state.js

構造:
{
  lessons: {
    [category: string]: {
      selected: boolean,
      expanded: boolean,
      levels: {
        [level: number]: {
          selected: boolean,
          expanded: boolean,
          lessons: {
            [lesson: string]: boolean
          }
        }
      }
    }
  },
  players: {
    [account: string]: {
      selected: boolean,
      expanded: boolean,
      groups: {
        [group: string]: {
          selected: boolean,
          expanded: boolean,
          players: {
            [player: string]: boolean
          }
        }
      }
    }
  },
  startMonth: string | null,   // 'YYYY-MM'形式
  endMonth: string | null,     // 'YYYY-MM'形式
  displayUnit: DisplayUnit     // 表示単位
}

7.2 DisplayUnit（表示単位）
--------------------------------------------------------------------------------
型: string
初期値: 'lesson'

利用可能な値:
┌──────────────────┬──────────────────────────────────────────────────────────┐
│ 値               │ 説明                                                     │
├──────────────────┼──────────────────────────────────────────────────────────┤
│ 'lesson'         │ レッスン単位                                             │
│ 'level'          │ レベル単位                                               │
│ 'category'       │ カテゴリ単位                                             │
└──────────────────┴──────────────────────────────────────────────────────────┘

7.3 sortState（ソート状態）
--------------------------------------------------------------------------------
型: Object
定義場所: public/js/state.js

構造:
{
  column: string | null,  // ソートカラム
  metric: SortMetric,     // ソート基準
  order: SortOrder        // ソート順
}

SortMetric: 'playCount' | 'totalTime' | 'avgScore'
SortOrder: 'asc' | 'desc'

7.4 playerSortState（プレイヤーソート状態）
--------------------------------------------------------------------------------
型: Object
定義場所: public/js/state.js

構造:
{
  column: string,   // デフォルト: 'player'
  order: SortOrder  // デフォルト: 'asc'
}

7.5 logSortState（ログソート状態）
--------------------------------------------------------------------------------
型: Object
定義場所: public/js/state.js

構造:
{
  column: LogSortColumn,  // デフォルト: 'date'
  order: SortOrder        // デフォルト: 'desc'
}

LogSortColumn: 'date' | 'player' | 'group' | 'category' | 'level' | 'lesson' | 'score' | 'playTime'

7.6 logPaginationState（ログページネーション状態）
--------------------------------------------------------------------------------
型: Object
定義場所: public/js/state.js

構造:
{
  currentPage: number,    // 現在のページ（1始まり）
  itemsPerPage: number,   // ページあたりの件数（デフォルト: 100）
  totalItems: number      // 総件数
}


================================================================================
8. エージェントシステムデータ
================================================================================

8.1 AgentOrchestrator
--------------------------------------------------------------------------------
型: Class
定義場所: public/js/agents.js
グローバル参照: window.agentOrchestrator

プロパティ:
{
  roleplaySupportAgent: RoleplaySupportAgent,
  scriptGenerationAgents: ScriptGenerationAgents,
  systemPromptAgents: SystemPromptAgents,
  feedbackAgent: FeedbackAgent,
  initialized: boolean
}

8.2 プロンプトファイル一覧
--------------------------------------------------------------------------------
ディレクトリ: prompts/

┌────────────────────────────────────────────┬─────────────────────────────────┐
│ ファイル名                                 │ 用途                            │
├────────────────────────────────────────────┼─────────────────────────────────┤
│ roleplay-support-agent.md                  │ チャットサポートエージェント    │
│ script-generation-subtitle.md              │ 台本モード台本生成              │
│ script-generation-points.md                │ ポイントモード台本生成          │
│ script-generation-practice.md              │ 実戦モード台本生成              │
│ system-prompt-subtitle-mode.md             │ 台本モードシステムプロンプト    │
│ system-prompt-aiDemo-mode.md               │ お手本モードシステムプロンプト  │
│ system-prompt-confirmation-mode.md         │ 確認モードシステムプロンプト    │
│ system-prompt-practice-mode.md             │ 実戦モードシステムプロンプト    │
│ feedback-prompt.md                         │ フィードバック生成              │
│ README.md                                  │ プロンプトファイルの説明        │
└────────────────────────────────────────────┴─────────────────────────────────┘

8.3 AGENT_API_CONFIG
--------------------------------------------------------------------------------
型: Object
定義場所: public/js/agents.js

構造:
{
  claudeCodeAPI: string,    // Claude Code API Key
  anthropicAPI: string,     // Anthropic API Key
  endpoint: '/api/agents'   // エージェントAPIエンドポイント
}


================================================================================
9. UIコンポーネントデータ
================================================================================

9.1 ファイルタイプ選択ボタン（サジェストボタン）
--------------------------------------------------------------------------------
データ種別: 【固定データ】ハードコード

定義場所: askFileType関数内
表示タイミング: ファイルアップロード時

ボタン一覧:
┌──────────┬──────────────────────────────────────────────────────────────────┐
│ dataType │ 表示テキスト                                                     │
├──────────┼──────────────────────────────────────────────────────────────────┤
│ sample   │ 📖 見本データ（商談や接客の正解例）                              │
│ material │ 📚 教材データ（学ばせたい内容の資料）                            │
│ company  │ 🏢 自社データ（商品情報や会社概要）                              │
│ customer │ 👥 顧客データ（想定顧客やペルソナ）                              │
│ other    │ 📄 その他                                                        │
└──────────┴──────────────────────────────────────────────────────────────────┘

9.2 台本表示のダイアログ行
--------------------------------------------------------------------------------
型: Object

構造（ParsedScript）:
{
  scene: string,        // シーン設定
  player: string,       // プレイヤー名（デフォルト: '営業'）
  opponent: string,     // 相手名（デフォルト: 'お客さん'）
  dialogues: Dialogue[] // 会話配列
}

Dialogue型:
{
  speaker: string,  // 発言者（'プレイヤー' | '相手' | 'ナレーター'）
  text: string      // 発言内容
}

発言者アイコンマッピング:
┌──────────────┬──────────┬──────────────────────┐
│ speaker      │ アイコン │ CSSクラス            │
├──────────────┼──────────┼──────────────────────┤
│ プレイヤー   │ 👤       │ player               │
│ ナレーター   │ 📢       │ narrator             │
│ その他       │ 💼       │ opponent             │
└──────────────┴──────────┴──────────────────────┘


================================================================================
10. 定数・設定値
================================================================================

10.1 スコア判定
--------------------------------------------------------------------------------
成功: score >= 70
失敗: score < 70

10.2 ページネーション
--------------------------------------------------------------------------------
デフォルト表示件数: 100件/ページ

10.3 日付フォーマット
--------------------------------------------------------------------------------
ISO形式: YYYY-MM-DDTHH:mm:ss.sssZ
表示形式: YYYY/MM/DD HH:mm（JST変換後）
月選択形式: YYYY-MM


================================================================================
11. ダミーデータ一覧
================================================================================

以下のデータは開発・デモ用のダミーデータです：

┌─────────────────────────────────┬───────────────────────────────────────────┐
│ データ                         │ 説明                                      │
├─────────────────────────────────┼───────────────────────────────────────────┤
│ demo-data.csv                   │ プレイセッションのダミーデータ            │
│                                 │ 本番では実データCSVをアップロード         │
├─────────────────────────────────┼───────────────────────────────────────────┤
│ CSV_DATA（data.js内）           │ 空のCSVテンプレート                       │
│                                 │ ヘッダーのみでデータなし                  │
├─────────────────────────────────┼───────────────────────────────────────────┤
│ 初期モードプロンプト            │ 4モード分の空プロンプトで初期化           │
│                                 │ ロープレ生成時に上書き                    │
└─────────────────────────────────┴───────────────────────────────────────────┘


================================================================================
12. データフロー図
================================================================================

[ファイルアップロードデータフロー]
File → uploadedFiles[] → extractedText → RoleplayDesignData → Agents → Scripts/Prompts

[セッションデータフロー]
demo-data.csv → parseCSV() → allSessions[] → filterState → 表示

[ロープレ生成データフロー]
RoleplayDesignData + uploadedFiles[]
    ↓
AgentOrchestrator.generateRoleplay()
    │
    ├── ScriptGenerationAgents → Scripts{subtitle, points, practice}
    │
    └── SystemPromptAgents → SystemPrompts{subtitle, aiDemo, confirmation, practice}
    ↓
displayScript() → 会話の流れタブ
displayModePrompts() → 設計書タブ
    ↓
editedPrompts/editedScript → OpenAI Realtime API


================================================================================
以上
================================================================================
